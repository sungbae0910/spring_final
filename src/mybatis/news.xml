<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="news">
	<!-- select -->
	<select id="main_t_news_i" resultMap="mm_news">
		select * from (select * from news_info order by nserial asc) where rownum &lt;= 9
	</select>
	<select id="main_t_news_p" resultType="newsController.NewsPhotoVo">
		select * from (select * from news_photo where rowid in (select max(rowid) from news_photo group by nserial) order by nserial asc  ) where rownum &lt;= 9	
	</select>
	
	<select id="main_cate_All" resultMap="mm_news">
		select * from (select * from (select * from news_photo where rowid in (select max(rowid) from news_photo group by nserial) order by dbms_random.value) where rownum &lt;=4) a join news_info b on a.nserial = b.nserial
	</select>
	
	<select id="main_cate_de" parameterType="String" resultMap="mm_news">
		select * from (select * from news_photo where rowid in (select max(rowid) from news_photo group by nserial) order by nserial desc)a join news_info b on a.nserial = b.nserial where b.ncategory='${value}' and rownum &lt;= 4
	</select>
	
	<select id="main_hit_desc" resultMap="mm_news">
	select * from 
		(select * from 
			(select * from news_photo where rowid in 
			 	(select max(rowid) 
			 	 from news_photo group by nserial)
			 )a join news_info b on a.nserial = b.nserial order by nhit desc
		 ) where rownum &lt;=4
	</select>
	
	<select id="detailView" parameterType="String" resultMap="mm_news">
		select * from (select * from news_photo where rowid in (select max(rowid) from news_photo group by nserial) order by nserial desc)a join news_info b on a.nserial = b.nserial where b.nSerial='${value}'
	</select>
	
	
	<!-- insert -->
	<insert id='news_insert' parameterType="newsController.NewsVo">
		insert into news_info values(seq_news_serial.nextval, #{nTitle}, #{nContent:VARCHAR}, #{nCompany}, sysdate, #{nRepoter}, #{nCategory}, 0, 0)
	</insert>
	
	<insert id='news_photo_insert' parameterType="newsController.NewsPhotoVo">
		insert into news_photo values(seq_nphoto_serial.nextval, seq_news_serial.currval, #{pName}, #{pContent})
	</insert>

	<!-- resultMap -->
	<resultMap id="mm_news" type="newsController.NewsVo">
		<result column="nSerial" property="nSerial"/>
		<result column="nContent" property="nContent" jdbcType="CLOB" javaType="java.lang.String"/>
		<result column="nTitle" property="nTitle"/>
		<result column="nCompany" property="nCompany"/>
		<result column="nDate" property="nDate"/>
		<result column="nRepoter" property="nRepoter"/>
		<result column="nCategory" property="nCategory"/>
		<result column="nLike" property="nLike"/>
		<result column="nHit" property="nHit"/>
		<collection property="photos" ofType="newsController.NewsPhotoVo">
			<result column="pSerial" property="pSerial"/>
			<result column="nSerial" property="nSerial"/>
			<result column="pName" property="pName"/>
			<result column="pContent" property="pContent"/>
		</collection>
	</resultMap>

</mapper>	